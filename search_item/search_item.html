<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Lost Items - Lost and Found</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="login-background">

    <!-- navbar-->
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container d-flex justify-content-between">
            <a class="navbar-brand" href="home.html">Lost and Found</a>
            <a href="index.html" class="btn btn-outline-light btn-sm">Logout</a>
        </div>
    </nav>

    <div class="container">
        <h2 class="mb-3">Look for a Lost Item</h2>
        <p class="text-muted">
            Enter keywords that describe your lost item (color, building, item type, etc.).
        </p>

        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form id="searchForm" class="row g-3">
                    <div class="col-md-10">
                        <label class="form-label">Search Keywords and be specific</label>
                        <input type="text" class="form-control" id="searchKeywords"
                               placeholder="e.g., black hoodie engineering building" required>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-success w-100 mt-2 mt-md-0">Search</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Search results -->
        <div id="searchResults"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS for searching -->
    <script>
        document.getElementById('searchForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const keywords = document.getElementById('searchKeywords').value.trim();
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = "";

            try {
                const response = await fetch('/api/items?keywords=' + encodeURIComponent(keywords));
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const items = await response.json();

                if (!Array.isArray(items) || items.length === 0) {
                    // No matches found â†’ show "call university police" message
                    resultsContainer.innerHTML = `
                        <div class="card border-danger mb-4">
                            <div class="card-body">
                                <h5 class="card-title text-danger">No Matching Items Found</h5>
                                <p class="card-text">
                                    We could not find any items that match your description.
                                    Please contact the University Police to report your lost item.
                                </p>
                                <p class="fw-bold">
                                    University Police:
                                    <span class="text-danger">+1 956 665 7151</span>
                                </p>
                            </div>
                        </div>
                    `;
                    return;
                }

                // Show matches from database
                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = "card shadow-sm mb-3";

                    card.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${item.item_type}</h5>
                            <p class="card-text mb-1"><strong>Building:</strong> ${item.building}</p>
                            <p class="card-text mb-1"><strong>Room:</strong> ${item.room}</p>
                            <p class="card-text mb-1"><strong>Color:</strong> ${item.color}</p>
                            <p class="card-text mb-1">
                                <strong>Date/Time Lost:</strong> ${item.date_lost || ""} ${item.time_lost || ""}
                            </p>
                            <p class="card-text"><strong>Details:</strong> ${item.details}</p>
                        </div>
                    `;

                    resultsContainer.appendChild(card);
                });
            } catch (err) {
                console.error(err);
                resultsContainer.innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        There was a problem searching for items. Please try again later.
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
