<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Lost Items</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="login-background">

<nav class="navbar navbar-dark bg-dark mb-4 utrgv-navbar">
    <div class="container d-flex flex-column justify-content-center align-items-center">
        <h1 class="navbar-title"><span class="utr-orange">UTRGV</span> Lost & Found</h1>
        <div class="navbar-actions mt-2">
            <a href="../home/index.html" class="btn btn-outline-light btn-sm">Home</a>
        </div>
    </div>
</nav>

<div class="container">
    <h2 class="mb-3">Look for a Lost Item</h2>
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form id="searchForm" class="row g-3">
                <div class="col-md-10">
                    <label class="form-label">Search Keywords</label>
                    <input type="text" class="form-control" id="searchKeywords" placeholder="e.g., black hoodie" required>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-success w-100">Search</button>
                </div>
            </form>
        </div>
    </div>

    <div id="searchResults"></div>
</div>

<script>
const form = document.getElementById("searchForm");
const input = document.getElementById("searchKeywords");
const resultsDiv = document.getElementById("searchResults");

form.addEventListener("submit", function(e){
    e.preventDefault();
    const keyword = input.value.toLowerCase().trim();
    resultsDiv.innerHTML = "";
    if(!keyword){
        resultsDiv.innerHTML = "<p class='text-muted text-center'>Please enter a keyword.</p>";
        return;
    }

    const allItemsObj = JSON.parse(localStorage.getItem("lostItems")) || {};
    const allItems = Object.values(allItemsObj).flat();

    const filtered = allItems.filter(item => 
        item.type.toLowerCase().includes(keyword) ||
        item.color.toLowerCase().includes(keyword) ||
        item.building.toLowerCase().includes(keyword) ||
        item.details.toLowerCase().includes(keyword)
    );

    if(filtered.length===0){
        resultsDiv.innerHTML = "<p class='text-muted text-center'>No matching items found.</p>";
        return;
    }

    function formatTime(time24) {
    if (!time24) return "";
    const [hourStr, min] = time24.split(":");
    let hour = parseInt(hourStr);
    const ampm = hour >= 12 ? "PM" : "AM";
    hour = hour % 12;
    if (hour === 0) hour = 12;
    return `${hour}:${min} ${ampm}`;
}

filtered.forEach(item => {
    const card = document.createElement("div");
    card.className = "card shadow-sm mb-3";

    card.innerHTML = `
        <div class="card-body">
            <h5 class="card-title text-capitalize">${item.color} ${item.type}</h5>
            <p><strong>Type:</strong> ${item.type}</p>
            <p><strong>Building:</strong> ${item.building}</p>
            <p><strong>Room:</strong> ${item.room}</p>
            <p><strong>Color:</strong> ${item.color}</p>
            <p><strong>Date/Time Lost:</strong> ${item.date} at ${formatTime(item.time)}</p>
            <p><strong>Details:</strong> ${item.details}</p>
        </div>
    `;

    resultsDiv.appendChild(card);
});

});
</script>

</body>
</html>
